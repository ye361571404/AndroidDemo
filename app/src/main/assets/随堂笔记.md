## Android基础第三天


### 数据库 ###

1. sqlserver2000   2008 特殊文件  .mdf
2. access  文件
3. mysql 
4. oracle 
5. sqlite 轻量级数据库  
6. 什么时候需要用到数据库的这个技术 ？？？？
7. 有大量相似结构的数据需要存储的时候  有一个好处 查询速度快 
8. File file = new File("info.txt"); 
9. FileoutPutStream fos = new FileoutPutStream(file);
 


# 1 Android下数据库创建
1. Android中创建一个数据库 要继承 

2. 定义一个类继承 SQLiteOpenHelper  
3. 要创建数据库 一定要调用

         创建数据库 需要调用  getReadableDatabase 或 getWritableDatabase



# 2 Android下数据库第一种方式增删改查
* 利用传统sql语句 sql语句非常容易出错


# 3 Android下另外一种增删改查方式

1. 第一种方式 写sql语句不容  没有返回值 不利于我们判断  它容易进行多表查询
2. 第二方式  不用写sql语句 有返回值 不容易进行多表查询  
 

helper.getWritableDatabase();

       加了一把锁    多个线程不能去写 
       public SQLiteDatabase getWritableDatabase() {
        synchronized (this) {
            return getDatabaseLocked(true);
        }
    }

helper.getReadableDatabase();

      读的时候么有加锁 多个线程去读没有问题 
      public SQLiteDatabase getReadableDatabase() {
        synchronized (this) {
            return getDatabaseLocked(false);
        }
    }

# 4 数据库的事务  
* 执行一段逻辑 要么同时成功 要么同时失败  只 执行sql语句 
* 银行转账的案例    
* 张三 给李四转账  
* 张三-100  
* 李四+100


* Android提供一个命令行工具 :sqlite3  就可以打开一个数据库 


    	// 如何开启一个事物
		db.beginTransaction(); // 开启事务
		try {
			// 要执行 我们转账的逻辑
			db.execSQL("update info set money= money -100 where name = ?",
					new Object[] { "张三" });
			// 模拟一个异常
			int i = 1 / 0;

			db.execSQL("update info set money= money +100 where name = ?",
					new Object[] { "李四" });

			// 设置一个 标记 来表示事务是否成功了
			db.setTransactionSuccessful();
		} catch (Exception e) {

			
			Toast.makeText(getApplicationContext(), "服务器忙!!请稍后在转", 1).show();
		}

		finally {
			db.endTransaction(); // 关闭事务
		}

	}



------------------------------------------------------------

# 5 listview 入门 （重要 ）
1. 也是Android中的一个控件  和 button textview 没有任何区别

01-04 06:39:07.394: E/dalvikvm-heap(1686): Out of memory on a 43532-byte allocation.  内存溢出 为什么会内存溢出呢 ?



* 数据适配器 把数据显示到listview的原理 
javaweb中
1. mvc
2. m---mode ---模型   javabean 
3. v---view----破jsp  
4. c---controller--破servlet 
       
Android中
1. m ---mode ------  要显示的数据
2. v----view-------   listview
3. c----controller ---Adapter



#6 listview优化
    if (convertView == null) {
				// convertView ==null 的时候 我去新的view 对象
				
				textView = new TextView(getApplicationContext());
				System.out.println("创建新的view对象--"+position);
				 
			}else {
				// 历史缓存对象不为空的时候   复用历史缓存对象 
				textView = (TextView) convertView;
				System.out.println("复用历史缓存对象--"+position);
				
			}

#7 listview---老虎机


#8 listview显示原理


#9 复杂listview界面显示 （重要）
* 主要是通过布局填充器 把一个xml布局文件 转换成一个view 对象 


		
#10 常用获取inflate的写法

    //1 方法拿到一个布局填充器
//				 view = View.inflate(getApplicationContext(), R.layout.item, null);
				 
				//2 方法拿到一个布局填充器 
//				 LayoutInflater inflater = LayoutInflater.from(getApplicationContext());
//				 view =  inflater.inflate(R.layout.item, null);
				 
				//3 方法去拿到一个布局填充器    源码分析的课 
				 LayoutInflater inflater = (LayoutInflater)getSystemService(LAYOUT_INFLATER_SERVICE);
				 view =  inflater.inflate(R.layout.item, null);
				
    	//4方法拿到布局填充器    感谢 --黄涛 
				 view  = getLayoutInflater().inflate(R.layout.item, null);


#11 arrayadapter    

    		lv.setAdapter(new ArrayAdapter<String>(getApplicationContext(), R.layout.item, R.id.textView1, objects));

#12 simpleadapter  
* 每个item 要显示的数据 用map封装
		

#13 数据库的listview的界面显示（重要）
* 从数据库里查询数据 把数据封装到list中
* 创建listview  
* 创建listview需要 适配器 
* getcount 方法应该  集合size 
* getView() 采用布局填充器 把一个布局转换成一个view  view.fin.....



